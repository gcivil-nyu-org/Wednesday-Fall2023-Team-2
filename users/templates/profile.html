{% extends "main.html" %} {% block content %}

<div class="container-lg">
  {% if request.user.is_authenticated %}
  <div class="d-flex justify-content-end py-2 px-2">
    <a href="#" class="btn btn-outline-secondary" onClick="document.getElementById('logout-form').submit()">
      Logout
    </a>
    <form id="logout-form" method="POST" action="{% url 'users:logout' %}">
      {% csrf_token %}
      <input type="hidden" />
    </form>
  </div>
  {% endif %}
  <div class="row">
    <h2>Profile Info</h2>
  </div>
  <div class="row align-items-center justify-content-start">
    <!--Profile Avatar-->
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">

    <div class="media relative col-md-2">
      <img src="{{ user.avatar.url }}" width="100" height="100"
        style="vertical-align:top;margin:20px 20px;float:left;border:5px solid black" />
        {% if user.is_verified %}
        <div class="absolute w-4 h-4 right-10 bottom-4 rounded-full bg-blue-400 text-white text-xs text-center leading-4">✓</div>
        {% else %}
        <div class="absolute w-4 h-4 right-10 bottom-4 rounded-full bg-gray-400 text-white text-xs text-center leading-4">✓</div>
        {% endif %}
    </div>
    
    <!--END Profile Avatar-->
    <div class="col-md-10">
      <div class="row">
        <div class="col">Email</div>
        <div class="col">{{ user.email }}</div>
      </div>
      <div class="row">
        <div class="col">Username</div>
        <div class="col">{{ user.username }}</div>
      </div>
      <div class="row">
        <div class="col">Description</div>
        <div class="col">{{ user.description }}</div>
      </div>
    </div>
  </div>

  <!--posts-->
  <div class="row">
    <h2>User's Posts</h2>
  </div>
  <div class="row">
    <div class="d-flex flex-wrap">
      {% for post in user_posts %}
      <div class="post-box border rounded p-3 m-2">
        <h3>{{ post.title }}</h3>
        <p>{{ post.post }}</p>
        <p>Posted on {{ post.created_at }}</p>
      </div>
      {% empty %}
      <p>No posts found for this user.</p>
      {% endfor %}
    </div>
  </div>
  <!--END posts-->

  <div class="row"></div>

  <!--Delete Account-->
  {% if request.user.is_authenticated and is_user_owner_of_profile %}
  <!-- Delete Button to Trigger Modal -->
  <div class="row justify-content-end py-2">

    <div class="col-md-1">
      <!--Edit Profile-->
      <a href="{% url 'users:profile_edit' request.user.username %}" class="btn btn-primary mx-4">Edit</a>
      <!--END Edit Profile-->
    </div>
    <div class="col-md-2">
      <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteAccountModal">
        Delete Account
      </button>
    </div>
    <div class="col-md-3">
        <a href="{% url 'users:verification' request.user.username %}" class="btn btn-primary mx-4">Verify</a>
      </div>

    <!-- Delete Account Modal -->
    <div class="modal fade" id="deleteAccountModal" tabindex="-1" role="dialog" aria-labelledby="deleteAccount"
      aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="deleteAccountTitle">Delete Account</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
            </button>
          </div>
          <div class="modal-body">
            Are you sure you want to delete your account?
          </div>
          <div class="modal-footer">
            <form action="{% url 'users:profile_delete' request.user.username %}" method="POST">
              {% csrf_token %}
              <button type="submit" name="delete_profile" class="btn btn-danger">Yes</button>
            </form>
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          </div>
        </div>
      </div>
    </div>
    {% if messages %}
    <ul class="messages">
      {% for message in messages %}
      {% if message.tags == 'error' %}
      <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
        {% endif %}
        {% endfor %}
    </ul>
    {% endif %}
  </div>
</div>
{% endif %}
<!--END Delete Account-->

{% endblock %}